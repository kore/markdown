<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kore's Markdown Viewer</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/15.0.7/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/bash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/yaml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/dockerfile.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.2/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<style>
  :root {
    /* FernUniversität in Hagen — institutional palette */
    --fuh-blue:       #004C97;   /* Pantone 2945 — primary */
    --fuh-red:        #993333;   /* Pantone 492  — Rechtswissenschaft */
    --fuh-teal:       #006666;   /* Pantone 323  — Mathematik & Informatik */
    --fuh-orange:     #C84F0E;   /* Pantone 166  — Kultur- & Sozialwissenschaften */
    --fuh-green:      #336600;   /* Pantone 364  — Wirtschaftswissenschaft */
    --fuh-purple:     #61307A;   /* Pantone 520  — Psychologie */

    /* Functional tokens derived from palette */
    --color-primary:       var(--fuh-blue);
    --color-accent:        var(--fuh-teal);
    --color-heading:       var(--fuh-blue);
    --color-link:          var(--fuh-teal);
    --color-link-hover:    var(--fuh-orange);
    --color-code-bg:       #f4f6f8;
    --color-code-border:   #d8dee4;
    --color-table-header:  var(--fuh-blue);
    --color-table-stripe:  #f0f4f8;
    --color-hr:            var(--fuh-blue);
    --color-blockquote:    var(--fuh-orange);

    /* Surface & text */
    --color-bg:            #ffffff;
    --color-surface:       #fafbfc;
    --color-text:          #1a1a1a;
    --color-text-muted:    #5a6370;
    --color-border:        #d0d5db;

    /* Code blocks */
    --color-pre-bg:        #1e2736;
    --color-pre-text:      #d4dae3;
    --color-pre-border:    var(--color-accent);
    --color-blockquote-bg: rgba(200, 79, 14, 0.04);

    /* highlight.js tokens */
    --hljs-keyword:   #7fbfff;
    --hljs-string:    #a8d4a2;
    --hljs-comment:   #6a7585;
    --hljs-variable:  #e0c589;
    --hljs-number:    #d4a0e0;
    --hljs-title:     #7fbfff;

    /* Toggle */
    --toggle-active-bg:    var(--fuh-blue);
    --toggle-inactive-bg:  #e2e6ea;
    --toggle-active-text:  #ffffff;
    --toggle-inactive-text:#4a5260;

    /* Layout */
    --content-max-width:   52rem;
    --spacing-page:        2.5rem;
  }

  /* ── Kore (light) theme ──────────────────────────── */
  [data-theme="kore"] {
    --color-primary:       #748e63;
    --color-accent:        #5a7a4a;
    --color-heading:       #4a6a3a;
    --color-link:          #5a7a4a;
    --color-link-hover:    #3d5c2e;
    --color-code-bg:       #f0eee6;
    --color-code-border:   #d6d2c4;
    --color-table-header:  #748e63;
    --color-table-stripe:  #f4f2ea;
    --color-hr:            #748e63;
    --color-blockquote:    #a08050;
    --color-blockquote-bg: rgba(160, 128, 80, 0.06);

    --color-bg:            #fdfcf6;
    --color-surface:       #f6f4ee;
    --color-text:          #141811;
    --color-text-muted:    #5a5e52;
    --color-border:        #d0cdc2;

    --color-pre-bg:        #2a2e24;
    --color-pre-text:      #d4d8c8;
    --color-pre-border:    #748e63;

    --hljs-keyword:   #8cc4a0;
    --hljs-string:    #b8cc8a;
    --hljs-comment:   #6a7562;
    --hljs-variable:  #d4c48a;
    --hljs-number:    #c4a0d4;
    --hljs-title:     #8cc4a0;

    --toggle-active-bg:    #748e63;
  }

  /* ── Kore Dark theme ─────────────────────────────── */
  [data-theme="kore-dark"] {
    --color-primary:       #748e63;
    --color-accent:        #8aaa76;
    --color-heading:       #a0be8c;
    --color-link:          #8aaa76;
    --color-link-hover:    #b0d09a;
    --color-code-bg:       #282e22;
    --color-code-border:   #3a4232;
    --color-table-header:  #4a6040;
    --color-table-stripe:  #1e2418;
    --color-hr:            #748e63;
    --color-blockquote:    #a08050;
    --color-blockquote-bg: rgba(160, 128, 80, 0.08);

    --color-bg:            #1a1e16;
    --color-surface:       #22271d;
    --color-text:          #d8d8d0;
    --color-text-muted:    #9a9e90;
    --color-border:        #3a4032;

    --color-pre-bg:        #141810;
    --color-pre-text:      #d0d4c4;
    --color-pre-border:    #748e63;

    --hljs-keyword:   #8cc4a0;
    --hljs-string:    #b8cc8a;
    --hljs-comment:   #6a7562;
    --hljs-variable:  #d4c48a;
    --hljs-number:    #c4a0d4;
    --hljs-title:     #8cc4a0;

    --toggle-active-bg:    #748e63;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  html { font-size: 16px; }

  body {
    font-family: "Source Sans 3", "Source Sans Pro", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: var(--color-surface);
    color: var(--color-text);
    line-height: 1.65;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* ── Header bar ─────────────────────────────────────── */
  .header {
    position: sticky;
    top: 0;
    z-index: 100;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    padding: 0.6rem var(--spacing-page);
    background: var(--color-primary);
    color: #fff;
    box-shadow: 0 1px 4px rgba(0,0,0,.15);
  }

  .header-title {
    font-size: 0.95rem;
    font-weight: 600;
    letter-spacing: 0.02em;
    opacity: 0.92;
  }

  /* ── Mode toggle ────────────────────────────────────── */
  .header-actions {
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }

  .export-group {
    display: flex;
    gap: 2px;
  }

  .export-btn {
    border: 1px solid rgba(255,255,255,.3);
    background: transparent;
    color: rgba(255,255,255,.8);
    font-size: 1rem;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.15s ease;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .export-btn:hover {
    background: rgba(255,255,255,.15);
    border-color: rgba(255,255,255,.5);
    color: #fff;
  }

  .export-btn:active {
    background: rgba(255,255,255,.25);
  }

  .export-btn[disabled] {
    opacity: 0.5;
    cursor: wait;
  }

  .export-sep {
    width: 1px;
    height: 1.1em;
    background: rgba(255,255,255,.25);
    align-self: center;
    margin: 0 0.15rem;
  }

  .toggle-group {
    display: flex;
    gap: 2px;
    background: rgba(255,255,255,.15);
    border-radius: 6px;
    padding: 2px;
  }

  .toggle-btn {
    border: none;
    background: transparent;
    color: rgba(255,255,255,.7);
    font-size: 1rem;
    padding: 0.3rem 0.6rem;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.15s ease;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .toggle-btn[aria-pressed="true"] {
    background: #fff;
    color: var(--color-primary);
  }

  .toggle-btn:hover:not([aria-pressed="true"]) {
    background: rgba(255,255,255,.12);
    color: #fff;
  }

  /* ── Theme selector ───────────────────────────────── */
  .theme-selector {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: 1px solid rgba(255,255,255,.3);
    border-radius: 4px;
    padding: 0.25rem 0.5rem;
    transition: all 0.15s ease;
  }

  .theme-selector:hover {
    background: rgba(255,255,255,.15);
    border-color: rgba(255,255,255,.5);
  }

  .theme-selector .bi-palette {
    font-size: 1rem;
    color: rgba(255,255,255,.8);
    line-height: 1;
    pointer-events: none;
  }

  .theme-selector:hover .bi-palette {
    color: #fff;
  }

  .theme-select {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
    font-size: 0.78rem;
  }

  /* ── Main layout ────────────────────────────────────── */
  .main {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  /* ── Editor ─────────────────────────────────────────── */
  .editor-pane {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .editor-pane[hidden] { display: none; }

  #editor {
    flex: 1;
    width: 100%;
    max-width: var(--content-max-width);
    margin: 0 auto;
    padding: var(--spacing-page);
    padding-top: 1.8rem;
    border: none;
    outline: none;
    resize: none;
    background: var(--color-bg);
    color: var(--color-text);
    font-family: "JetBrains Mono", "Fira Code", "Source Code Pro", "Consolas", monospace;
    font-size: 0.88rem;
    line-height: 1.7;
    tab-size: 2;
  }

  /* ── Viewer ─────────────────────────────────────────── */
  .viewer-pane {
    flex: 1;
    overflow-y: auto;
    background: var(--color-bg);
  }

  .viewer-pane[hidden] { display: none; }

  #viewer {
    max-width: var(--content-max-width);
    margin: 0 auto;
    padding: var(--spacing-page);
    padding-top: 1.8rem;
  }

  /* ── Rendered markdown typography ───────────────────── */
  #viewer h1, #viewer h2, #viewer h3,
  #viewer h4, #viewer h5, #viewer h6 {
    color: var(--color-heading);
    font-weight: 700;
    line-height: 1.3;
    margin-top: 2em;
    margin-bottom: 0.5em;
  }

  #viewer h1 { font-size: 1.8rem; padding-bottom: 0.3em; border-bottom: 2px solid var(--color-hr); }
  #viewer h2 { font-size: 1.4rem; padding-bottom: 0.25em; border-bottom: 1px solid var(--color-border); }
  #viewer h3 { font-size: 1.15rem; }
  #viewer h4 { font-size: 1rem; color: var(--color-text-muted); }

  #viewer h1:first-child { margin-top: 0; }

  #viewer p { margin: 0.8em 0; }

  #viewer a {
    color: var(--color-link);
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
    transition: color 0.12s;
  }
  #viewer a:hover { color: var(--color-link-hover); }

  #viewer strong { font-weight: 700; }

  #viewer hr {
    border: none;
    height: 2px;
    background: var(--color-hr);
    opacity: 0.2;
    margin: 2em 0;
  }

  #viewer blockquote {
    margin: 1.2em 0;
    padding: 0.6em 1.2em;
    border-left: 3px solid var(--color-blockquote);
    background: var(--color-blockquote-bg);
    color: var(--color-text);
  }
  #viewer blockquote p { margin: 0.3em 0; }

  #viewer ul, #viewer ol { margin: 0.8em 0; padding-left: 1.8em; }
  #viewer li { margin: 0.25em 0; }
  #viewer li > ul, #viewer li > ol { margin: 0.2em 0; }

  /* Checkboxes */
  #viewer ul:has(> li > input[type="checkbox"]) {
    list-style: none;
    padding-left: 0.4em;
  }
  #viewer input[type="checkbox"] {
    margin-right: 0.45em;
    accent-color: var(--color-accent);
    transform: translateY(1px);
  }

  /* ── Code ────────────────────────────────────────────── */
  #viewer code {
    font-family: "JetBrains Mono", "Fira Code", "Source Code Pro", "Consolas", monospace;
    font-size: 0.85em;
  }

  #viewer :not(pre) > code {
    background: var(--color-code-bg);
    border: 1px solid var(--color-code-border);
    border-radius: 3px;
    padding: 0.15em 0.35em;
  }

  #viewer pre {
    margin: 1.2em 0;
    padding: 1em 1.2em;
    background: var(--color-pre-bg);
    border-radius: 4px;
    overflow-x: auto;
    border-left: 3px solid var(--color-pre-border);
  }

  #viewer pre code {
    background: none;
    border: none;
    padding: 0;
    color: var(--color-pre-text);
    font-size: 0.82rem;
    line-height: 1.6;
  }

  /* highlight.js overrides for dark code blocks */
  #viewer pre .hljs-keyword,
  #viewer pre .hljs-built_in  { color: var(--hljs-keyword); }
  #viewer pre .hljs-string    { color: var(--hljs-string); }
  #viewer pre .hljs-comment   { color: var(--hljs-comment); font-style: italic; }
  #viewer pre .hljs-variable,
  #viewer pre .hljs-attr       { color: var(--hljs-variable); }
  #viewer pre .hljs-number    { color: var(--hljs-number); }
  #viewer pre .hljs-title     { color: var(--hljs-title); }

  /* ── Tables ─────────────────────────────────────────── */
  #viewer table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.2em 0;
    font-size: 0.9rem;
  }

  #viewer thead th {
    background: var(--color-table-header);
    color: #fff;
    font-weight: 600;
    text-align: left;
    padding: 0.55em 0.8em;
  }

  #viewer thead th:first-child { border-radius: 4px 0 0 0; }
  #viewer thead th:last-child  { border-radius: 0 4px 0 0; }

  #viewer tbody td {
    padding: 0.5em 0.8em;
    border-bottom: 1px solid var(--color-border);
  }

  #viewer tbody tr:nth-child(even) { background: var(--color-table-stripe); }

  /* ── Images ─────────────────────────────────────────── */
  #viewer img {
    max-width: 100%;
    border-radius: 4px;
    margin: 0.5em 0;
  }

  /* ── Print ──────────────────────────────────────────── */
  @media print {
    .header { position: static; background: #fff; color: var(--color-primary); box-shadow: none; border-bottom: 2px solid var(--color-primary); }
    .toggle-group { display: none; }
    .export-group { display: none; }
    .theme-selector { display: none; }
    .editor-pane { display: none !important; }
    .viewer-pane { display: block !important; }
    #viewer pre { border-left-color: var(--color-accent); }
  }
</style>
</head>
<body>

<header class="header">
  <span class="header-title">Kore's Markdown Viewer</span>
  <div class="header-actions">
    <div class="export-group">
      <button class="export-btn" id="btn-upload" title="Open .md file"><i class="bi bi-folder2-open"></i></button>
      <button class="export-btn" id="btn-save" title="Save as .md"><i class="bi bi-floppy"></i></button>
      <span class="export-sep"></span>
      <button class="export-btn" id="btn-pdf" title="Export as PDF"><i class="bi bi-filetype-pdf"></i></button>
      <button class="export-btn" id="btn-docx" title="Export as Word"><i class="bi bi-filetype-doc"></i></button>
      <span class="export-sep"></span>
      <div class="theme-selector">
        <i class="bi bi-palette"></i>
        <select class="theme-select" id="theme-select" title="Select theme">
          <option value="">FernUni Hagen</option>
          <option value="kore">Kore</option>
          <option value="kore-dark">Kore Dark</option>
        </select>
      </div>
      <div class="toggle-group" role="radiogroup" aria-label="Editor mode">
        <button class="toggle-btn" id="btn-edit" aria-pressed="true" role="radio"><i class="bi bi-pencil"></i></button>
        <button class="toggle-btn" id="btn-view" aria-pressed="false" role="radio"><i class="bi bi-eye"></i></button>
      </div>
    </div>
    <input type="file" id="file-input" accept=".md,.markdown,.txt" hidden>
  </div>
</header>

<main class="main">
  <div class="editor-pane" id="pane-edit">
    <textarea id="editor" spellcheck="false" autofocus># Markdown

Just enter some markdown text…</textarea>
  </div>
  <div class="viewer-pane" id="pane-view" hidden>
    <div id="viewer"></div>
  </div>
</main>

<script>
(function () {
  const editor   = document.getElementById('editor');
  const viewer   = document.getElementById('viewer');
  const paneEdit = document.getElementById('pane-edit');
  const paneView = document.getElementById('pane-view');
  const btnEdit  = document.getElementById('btn-edit');
  const btnView  = document.getElementById('btn-view');

  /* ── Theme switching ───────────────────────────── */
  const themeSelect = document.getElementById('theme-select');
  const THEME_KEY = 'md-viewer-theme';

  function applyTheme(theme) {
    if (theme) {
      document.documentElement.dataset.theme = theme;
    } else {
      delete document.documentElement.dataset.theme;
    }
    themeSelect.value = theme || '';
  }

  applyTheme(localStorage.getItem(THEME_KEY) ?? 'kore');

  themeSelect.addEventListener('change', () => {
    const theme = themeSelect.value;
    applyTheme(theme);
    localStorage.setItem(THEME_KEY, theme);
  });

  /* ── marked.js configuration ─────────────────────── */
  marked.setOptions({
    gfm: true,
    breaks: false,
    highlight: function (code, lang) {
      if (lang && hljs.getLanguage(lang)) {
        try { return hljs.highlight(code, { language: lang }).value; }
        catch (_) {}
      }
      return hljs.highlightAuto(code).value;
    }
  });

  /* ── Render ──────────────────────────────────────── */
  function render() {
    viewer.innerHTML = marked.parse(editor.value);
    viewer.querySelectorAll('a').forEach(a => {
      a.setAttribute('target', '_blank');
      a.setAttribute('rel', 'noopener');
    });
  }

  /* ── Mode switching ──────────────────────────────── */
  function setMode(mode) {
    const isEdit = mode === 'edit';

    paneEdit.hidden = !isEdit;
    paneView.hidden = isEdit;
    btnEdit.setAttribute('aria-pressed', isEdit);
    btnView.setAttribute('aria-pressed', !isEdit);

    if (isEdit) {
      editor.focus();
    } else {
      render();
    }
  }

  btnEdit.addEventListener('click', () => setMode('edit'));
  btnView.addEventListener('click', () => setMode('view'));

  /* ── Keyboard shortcut: Ctrl/Cmd+E to toggle ────── */
  document.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
      e.preventDefault();
      setMode(paneEdit.hidden ? 'edit' : 'view');
    }
    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
      e.preventDefault();
      btnSave.click();
    }
    if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
      e.preventDefault();
      btnUpload.click();
    }
  });

  /* ── Tab key inserts spaces in editor ────────────── */
  editor.addEventListener('keydown', (e) => {
    if (e.key === 'Tab') {
      e.preventDefault();
      const start = editor.selectionStart;
      const end   = editor.selectionEnd;
      editor.value = editor.value.substring(0, start) + '  ' + editor.value.substring(end);
      editor.selectionStart = editor.selectionEnd = start + 2;
    }
  });

  /* ── Persistence via localStorage ────────────────── */
  const STORAGE_KEY = 'md-editor-content';

  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved !== null) {
    editor.value = saved;
  }

  editor.addEventListener('input', () => {
    localStorage.setItem(STORAGE_KEY, editor.value);
  });

  /* ── File drop ───────────────────────────────────── */
  editor.addEventListener('dragover', (e) => { e.preventDefault(); });
  editor.addEventListener('drop', (e) => {
    e.preventDefault();
    const file = e.dataTransfer.files[0];
    if (file && file.name.endsWith('.md')) {
      const reader = new FileReader();
      reader.onload = (ev) => {
        editor.value = ev.target.result;
        localStorage.setItem(STORAGE_KEY, editor.value);
      };
      reader.readAsText(file);
    }
  });

  /* ── Export helpers ─────────────────────────────── */
  const btnPdf   = document.getElementById('btn-pdf');
  const btnDocx  = document.getElementById('btn-docx');
  const btnSave  = document.getElementById('btn-save');
  const btnUpload = document.getElementById('btn-upload');
  const fileInput = document.getElementById('file-input');

  function getFilename() {
    const match = editor.value.match(/^#\s+(.+)$/m);
    const name = match ? match[1].replace(/[^\w\s-]/g, '').trim().replace(/\s+/g, '-').toLowerCase() : 'document';
    return name;
  }

  /* ── Save as .md ───────────────────────────────── */
  btnSave.addEventListener('click', () => {
    const blob = new Blob([editor.value], { type: 'text/markdown;charset=utf-8' });
    saveAs(blob, getFilename() + '.md');
  });

  /* ── Open .md file ─────────────────────────────── */
  btnUpload.addEventListener('click', () => fileInput.click());

  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      editor.value = ev.target.result;
      localStorage.setItem(STORAGE_KEY, editor.value);
      setMode('edit');
    };
    reader.readAsText(file);
    fileInput.value = '';  // allow re-opening the same file
  });

  function ensureRendered() {
    // Make sure viewer has current content (render off-screen if in edit mode)
    viewer.innerHTML = marked.parse(editor.value);
  }

  /* ── PDF export via html2pdf.js ────────────────── */
  btnPdf.addEventListener('click', async () => {
    btnPdf.disabled = true;
    ensureRendered();

    // Clone viewer so we can style it for export without affecting the page
    const clone = viewer.cloneNode(true);
    clone.style.padding = '0';
    clone.style.maxWidth = 'none';

    try {
      await html2pdf().set({
        margin:      [12, 14, 12, 14],  // mm: top, left, bottom, right
        filename:    getFilename() + '.pdf',
        image:       { type: 'jpeg', quality: 0.95 },
        html2canvas: { scale: 2, useCORS: true, scrollY: 0 },
        jsPDF:       { unit: 'mm', format: 'a4', orientation: 'portrait' },
        pagebreak:   { mode: ['avoid-all', 'css', 'legacy'] }
      }).from(clone).save();
    } catch (err) {
      console.error('PDF export failed:', err);
    }

    btnPdf.disabled = false;
  });

  /* ── Word export via HTML-to-docx conversion ───── */
  btnDocx.addEventListener('click', () => {
    btnDocx.disabled = true;
    ensureRendered();

    // Read current theme colors from computed CSS variables
    const cs = getComputedStyle(document.documentElement);
    const v = (name) => cs.getPropertyValue(name).trim();

    // Build a self-contained HTML document with inline styles for Word
    const styles = `
      <style>
        body { font-family: Calibri, Arial, sans-serif; font-size: 11pt; line-height: 1.5; color: ${v('--color-text')}; }
        h1 { font-size: 20pt; color: ${v('--color-heading')}; border-bottom: 2pt solid ${v('--color-hr')}; padding-bottom: 4pt; }
        h2 { font-size: 16pt; color: ${v('--color-heading')}; border-bottom: 1pt solid ${v('--color-border')}; padding-bottom: 3pt; }
        h3 { font-size: 13pt; color: ${v('--color-heading')}; }
        h4 { font-size: 11pt; color: ${v('--color-text-muted')}; }
        a { color: ${v('--color-link')}; }
        code { font-family: Consolas, "Courier New", monospace; font-size: 10pt; background: ${v('--color-code-bg')}; padding: 1pt 3pt; }
        pre { background: ${v('--color-code-bg')}; border-left: 3pt solid ${v('--color-accent')}; padding: 8pt 12pt; font-size: 9pt; }
        pre code { background: none; padding: 0; }
        blockquote { border-left: 3pt solid ${v('--color-blockquote')}; padding-left: 12pt; color: ${v('--color-text')}; margin: 8pt 0; }
        table { border-collapse: collapse; width: 100%; margin: 8pt 0; }
        th { background: ${v('--color-table-header')}; color: white; padding: 5pt 8pt; text-align: left; font-weight: bold; }
        td { padding: 5pt 8pt; border-bottom: 1pt solid ${v('--color-border')}; }
        tr:nth-child(even) td { background: ${v('--color-table-stripe')}; }
        hr { border: none; border-top: 1pt solid ${v('--color-hr')}; }
      </style>
    `;

    const docContent = `
      <!DOCTYPE html>
      <html xmlns:o="urn:schemas-microsoft-com:office:office"
            xmlns:w="urn:schemas-microsoft-com:office:word"
            xmlns="http://www.w3.org/TR/REC-html40">
      <head>
        <meta charset="utf-8">
        <xml>
          <w:WordDocument>
            <w:View>Print</w:View>
            <w:Zoom>100</w:Zoom>
          </w:WordDocument>
        </xml>
        ${styles}
      </head>
      <body>${viewer.innerHTML}</body>
      </html>
    `;

    const blob = new Blob([docContent], { type: 'application/msword' });
    saveAs(blob, getFilename() + '.doc');

    btnDocx.disabled = false;
  });
})();
</script>

</body>
</html>
